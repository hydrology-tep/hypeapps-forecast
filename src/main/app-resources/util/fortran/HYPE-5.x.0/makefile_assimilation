# Variables
#f90comp = ifort
#switch = -auto-scalar -heap-arrays 1024 -fpp
#switch = -warn unused -warn uncalled -warn interfaces -O3 -ipo -auto-scalar -heap-arrays 1024
f90comp = gfortran 
switch = -fbacktrace -ffree-line-length-0 -Wall -fno-automatic -cpp -D_ASSIMILATION

objects = libdate.o hypevar.o modvar.o worvar.o general_wc.o general_func.o convert.o time.o compout.o hypetypes.o t_proc.o readwrite.o hype_indata.o atm_proc.o irrigation.o hype_wbout.o npc_soil_proc.o soil_proc.o regional_groundwater.o sw_proc.o npc_sw_proc.o soilmodel0.o glacier_soilmodel.o soilmodel4.o model_hype.o data.o optim.o statedata.o random_routines.o assimilation_variables.o assimilation_routines.o assimilation_interface.o main.o
modfiles = libdate.mod hypevariables.mod modvar.mod worldvar.mod general_water_concentration.mod general_functions.mod convert.mod timeroutines.mod compout.mod statetype_module.mod tracer_processes.mod readwrite_routines.mod hype_indata.mod atmospheric_processes.mod irrigation_module.mod hype_waterbalance.mod npc_soil_processes.mod soil_processes.mod regional_groundwater_module.mod surfacewater_processes.mod npc_surfacewater_processes.mod soilmodel_default.mod glacier_soilmodel.mod floodplain_soilmodel.mod modelmodule.mod datamodule.mod optimization.mod state_datamodule.mod random_routines.mod assimilation_variables.mod assimilation_routines.mod assimilation_interface.mod

# Makefile
hype_assimilation:	$(objects)
	$(f90comp) -o hype_assimilation $(switch) $(objects)

# All .o files are made from corresponding .f90 files
%.o:	%.f90
	$(f90comp) -c $(switch) $<
%.o:	%.F90
	$(f90comp) -c $(switch) $<
%.mod:	%.f90
	$(f90comp) -c $(switch) $<
%.mod:	%.F90
	$(f90comp) -c $(switch) $<

# Dependencies
modvar.o       : libdate.mod
convert.o      : libdate.mod
atm_proc.o     : hypevariables.mod modvar.mod hype_indata.mod
irrigation.o   : hypevariables.mod modvar.mod statetype_module.mod
t_proc.o       : hypevariables.mod modvar.mod statetype_module.mod general_water_concentration.mod general_functions.mod
npc_soil_proc.o: hypevariables.mod modvar.mod statetype_module.mod general_water_concentration.mod general_functions.mod
soil_proc.o    : hypevariables.mod modvar.mod statetype_module.mod general_water_concentration.mod general_functions.mod npc_soil_processes.mod atmospheric_processes.mod hype_indata.mod
npc_sw_proc.o  : hypevariables.mod modvar.mod statetype_module.mod general_water_concentration.mod general_functions.mod
sw_proc.o      : hypevariables.mod modvar.mod statetype_module.mod general_water_concentration.mod general_functions.mod soil_processes.mod
soilmodel0.o   : hypevariables.mod modvar.mod statetype_module.mod general_water_concentration.mod general_functions.mod npc_soil_processes.mod soil_processes.mod atmospheric_processes.mod regional_groundwater_module.mod irrigation_module.mod tracer_processes.mod 
glacier_soilmodel.o : hypevariables.mod modvar.mod statetype_module.mod general_water_concentration.mod npc_soil_processes.mod soil_processes.mod atmospheric_processes.mod regional_groundwater_module.mod tracer_processes.mod 
soilmodel4.o   : hypevariables.mod modvar.mod statetype_module.mod general_water_concentration.mod general_functions.mod npc_soil_processes.mod soil_processes.mod atmospheric_processes.mod regional_groundwater_module.mod irrigation_module.mod tracer_processes.mod 
regional_groundwater.o : hypevariables.mod modvar.mod statetype_module.mod general_water_concentration.mod npc_soil_processes.mod 
model_hype.o   : libdate.mod hypevariables.mod modvar.mod statetype_module.mod general_water_concentration.mod glacier_soilmodel.mod soilmodel_default.mod soil_processes.mod npc_soil_processes.mod surfacewater_processes.mod npc_surfacewater_processes.mod irrigation_module.mod regional_groundwater_module.mod hype_waterbalance.mod hype_indata.mod atmospheric_processes.mod tracer_processes.mod 
compout.o      : libdate.mod modvar.mod worldvar.mod timeroutines.mod convert.mod
worldvar.o     : libdate.mod modvar.mod
readwrite.o    : libdate.mod worldvar.mod convert.mod compout.mod
hype_wbout.o   : libdate.mod readwrite_routines.mod worldvar.mod modvar.mod
hype_indata.o  : libdate.mod readwrite_routines.mod worldvar.mod modvar.mod
timeroutines.o : libdate.mod worldvar.mod modvar.mod
data.o         : libdate.mod modvar.mod worldvar.mod convert.mod timeroutines.mod readwrite_routines.mod compout.mod modelmodule.mod 
optim.o        : libdate.mod modvar.mod worldvar.mod statetype_module.mod timeroutines.mod modelmodule.mod compout.mod datamodule.mod
statedata.o    : libdate.mod modvar.mod worldvar.mod statetype_module.mod modelmodule.mod readwrite_routines.mod
assimilation_variables.o   : random_routines.mod
assimilation_routines.o : assimilation_variables.mod random_routines.mod compout.mod
assimilation_interface.o : assimilation_variables.mod assimilation_routines.mod modvar.mod worldvar.mod hypevariables.mod statetype_module.mod compout.mod readwrite_routines.mod datamodule.mod
main.o         : libdate.mod modvar.mod worldvar.mod statetype_module.mod timeroutines.mod readwrite_routines.mod modelmodule.mod compout.mod datamodule.mod state_datamodule.mod assimilation_variables.mod assimilation_routines.mod assimilation_interface.mod


.PHONY : clean
clean:	
	rm -f $(objects)
	rm -f $(modfiles)
